(function() {
  var helpers;

  helpers = require('./spec-helper');

  describe("the input element", function() {
    var editor, editorElement, exState, getCommandEditor, getVisibility, ref, vimState;
    ref = [], editor = ref[0], editorElement = ref[1], vimState = ref[2], exState = ref[3];
    beforeEach(function() {
      var exMode, vimMode;
      vimMode = atom.packages.loadPackage('vim-mode-plus');
      exMode = atom.packages.loadPackage('ex-mode');
      waitsForPromise(function() {
        var activationPromise;
        activationPromise = exMode.activate();
        helpers.activateExMode();
        return activationPromise;
      });
      runs(function() {
        return spyOn(exMode.mainModule.globalExState, 'setVim').andCallThrough();
      });
      waitsForPromise(function() {
        return vimMode.activate();
      });
      waitsFor(function() {
        return exMode.mainModule.globalExState.setVim.calls.length > 0;
      });
      return runs(function() {
        return helpers.getEditorElement(function(element) {
          atom.commands.dispatch(element, "ex-mode:open");
          editorElement = element;
          editor = editorElement.getModel();
          atom.commands.dispatch(getCommandEditor(), "core:cancel");
          vimState = vimMode.mainModule.getEditorState(editor);
          exState = exMode.mainModule.exStates.get(editor);
          vimState.resetNormalMode();
          return editor.setText("abc\ndef\nabc\ndef");
        });
      });
    });
    afterEach(function() {
      return atom.commands.dispatch(getCommandEditor(), "core:cancel");
    });
    getVisibility = function() {
      return editor.normalModeInputView.panel.visible;
    };
    getCommandEditor = function() {
      return editor.normalModeInputView.editorElement;
    };
    it("opens with 'ex-mode:open'", function() {
      atom.commands.dispatch(editorElement, "ex-mode:open");
      return expect(getVisibility()).toBe(true);
    });
    it("closes with 'core:cancel'", function() {
      atom.commands.dispatch(editorElement, "ex-mode:open");
      expect(getVisibility()).toBe(true);
      atom.commands.dispatch(getCommandEditor(), "core:cancel");
      return expect(getVisibility()).toBe(false);
    });
    it("closes when opening and then pressing backspace", function() {
      atom.commands.dispatch(editorElement, "ex-mode:open");
      expect(getVisibility()).toBe(true);
      atom.commands.dispatch(getCommandEditor(), "core:backspace");
      return expect(getVisibility()).toBe(false);
    });
    it("doesn't close when there is text and pressing backspace", function() {
      var commandEditor, model;
      atom.commands.dispatch(editorElement, "ex-mode:open");
      expect(getVisibility()).toBe(true);
      commandEditor = getCommandEditor();
      model = commandEditor.getModel();
      model.setText('abc');
      atom.commands.dispatch(commandEditor, "core:backspace");
      expect(getVisibility()).toBe(true);
      return expect(model.getText()).toBe('ab');
    });
    it("closes when there is text and pressing backspace multiple times", function() {
      var commandEditor, model;
      atom.commands.dispatch(editorElement, "ex-mode:open");
      expect(getVisibility()).toBe(true);
      commandEditor = getCommandEditor();
      model = commandEditor.getModel();
      expect(model.getText()).toBe('');
      model.setText('abc');
      atom.commands.dispatch(commandEditor, "core:backspace");
      expect(getVisibility()).toBe(true);
      expect(model.getText()).toBe('ab');
      atom.commands.dispatch(commandEditor, "core:backspace");
      expect(getVisibility()).toBe(true);
      expect(model.getText()).toBe('a');
      atom.commands.dispatch(commandEditor, "core:backspace");
      expect(getVisibility()).toBe(true);
      expect(model.getText()).toBe('');
      atom.commands.dispatch(commandEditor, "core:backspace");
      return expect(getVisibility()).toBe(false);
    });
    return it("contains '<,'> when opened while there are selections", function() {
      editor.setCursorBufferPosition([0, 0]);
      editor.selectToBufferPosition([0, 1]);
      editor.addCursorAtBufferPosition([2, 0]);
      editor.selectToBufferPosition([2, 1]);
      atom.commands.dispatch(editorElement, "ex-mode:open");
      return expect(getCommandEditor().getModel().getText()).toBe("'<,'>");
    });
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiL2hvbWUvaHB1Ly5hdG9tL3BhY2thZ2VzL2V4LW1vZGUvc3BlYy9leC1pbnB1dC1zcGVjLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUFBLE1BQUE7O0VBQUEsT0FBQSxHQUFVLE9BQUEsQ0FBUSxlQUFSOztFQUNWLFFBQUEsQ0FBUyxtQkFBVCxFQUE4QixTQUFBO0FBQzVCLFFBQUE7SUFBQSxNQUE2QyxFQUE3QyxFQUFDLGVBQUQsRUFBUyxzQkFBVCxFQUF3QixpQkFBeEIsRUFBa0M7SUFDbEMsVUFBQSxDQUFXLFNBQUE7QUFDVCxVQUFBO01BQUEsT0FBQSxHQUFVLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBZCxDQUEwQixlQUExQjtNQUNWLE1BQUEsR0FBUyxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQWQsQ0FBMEIsU0FBMUI7TUFDVCxlQUFBLENBQWdCLFNBQUE7QUFDZCxZQUFBO1FBQUEsaUJBQUEsR0FBb0IsTUFBTSxDQUFDLFFBQVAsQ0FBQTtRQUNwQixPQUFPLENBQUMsY0FBUixDQUFBO2VBQ0E7TUFIYyxDQUFoQjtNQUtBLElBQUEsQ0FBSyxTQUFBO2VBQ0gsS0FBQSxDQUFNLE1BQU0sQ0FBQyxVQUFVLENBQUMsYUFBeEIsRUFBdUMsUUFBdkMsQ0FBZ0QsQ0FBQyxjQUFqRCxDQUFBO01BREcsQ0FBTDtNQUdBLGVBQUEsQ0FBZ0IsU0FBQTtlQUNkLE9BQU8sQ0FBQyxRQUFSLENBQUE7TUFEYyxDQUFoQjtNQUdBLFFBQUEsQ0FBUyxTQUFBO2VBQ1AsTUFBTSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUE3QyxHQUFzRDtNQUQvQyxDQUFUO2FBR0EsSUFBQSxDQUFLLFNBQUE7ZUFDSCxPQUFPLENBQUMsZ0JBQVIsQ0FBeUIsU0FBQyxPQUFEO1VBQ3ZCLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBZCxDQUF1QixPQUF2QixFQUFnQyxjQUFoQztV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V0FtQkEsRUFBQSxDQUFHLHVEQUFILEVBQTRELFNBQUE7TUFDMUQsTUFBTSxDQUFDLHVCQUFQLENBQStCLENBQUMsQ0FBRCxFQUFJLENBQUosQ0FBL0I7TUFDQSxNQUFNLENBQUMsc0JBQVAsQ0FBOEIsQ0FBQyxDQUFELEVBQUksQ0FBSixDQUE5QjtNQUNBLE1BQU0sQ0FBQyx5QkFBUCxDQUFpQyxDQUFDLENBQUQsRUFBSSxDQUFKLENBQWpDO01BQ0EsTUFBTSxDQUFDLHNCQUFQLENBQThCLENBQUMsQ0FBRCxFQUFJLENBQUosQ0FBOUI7TUFDQSxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQWQsQ0FBdUIsYUFBdkIsRUFBc0MsY0FBdEM7YUFDQSxNQUFBLENBQU8sZ0JBQUEsQ0FBQSxDQUFrQixDQUFDLFFBQW5CLENBQUEsQ0FBNkIsQ0FBQyxPQUE5QixDQUFBLENBQVAsQ0FBK0MsQ0FBQyxJQUFoRCxDQUFxRCxPQUFyRDtJQU4wRCxDQUE1RDtFQXBGNEIsQ0FBOUI7QUFEQSIsInNvdXJjZXNDb250ZW50IjpbImhlbHBlcnMgPSByZXF1aXJlICcuL3NwZWMtaGVscGVyJ1xuZGVzY3JpYmUgXCJ0aGUgaW5wdXQgZWxlbWVudFwiLCAtPlxuICBbZWRpdG9yLCBlZGl0b3JFbGVtZW50LCB2aW1TdGF0ZSwgZXhTdGF0ZV0gPSBbXVxuICBiZWZvcmVFYWNoIC0+XG4gICAgdmltTW9kZSA9IGF0b20ucGFja2FnZXMubG9hZFBhY2thZ2UoJ3ZpbS1tb2RlLXBsdXMnKVxuICAgIGV4TW9kZSA9IGF0b20ucGFja2FnZXMubG9hZFBhY2thZ2UoJ2V4LW1vZGUnKVxuICAgIHdhaXRzRm9yUHJvbWlzZSAtPlxuICAgICAgYWN0aXZhdGlvblByb21pc2UgPSBleE1vZGUuYWN0aXZhdGUoKVxuICAgICAgaGVscGVycy5hY3RpdmF0ZUV4TW9kZSgpXG4gICAgICBhY3RpdmF0aW9uUHJvbWlzZVxuXG4gICAgcnVucyAtPlxuICAgICAgc3B5T24oZXhNb2RlLm1haW5Nb2R1bGUuZ2xvYmFsRXhTdGF0ZSwgJ3NldFZpbScpLmFuZENhbGxUaHJvdWdoKClcblxuICAgIHdhaXRzRm9yUHJvbWlzZSAtPlxuICAgICAgdmltTW9kZS5hY3RpdmF0ZSgpXG5cbiAgICB3YWl0c0ZvciAtPlxuICAgICAgZXhNb2RlLm1haW5Nb2R1bGUuZ2xvYmFsRXhTdGF0ZS5zZXRWaW0uY2FsbHMubGVuZ3RoID4gMFxuXG4gICAgcnVucyAtPlxuICAgICAgaGVscGVycy5nZXRFZGl0b3JFbGVtZW50IChlbGVtZW50KSAtPlxuICAgICAgICBhdG9tLmNvbW1hbmRzLmRpc3BhdGNoKGVsZW1lbnQsIFwiZXgtbW9kZTpvcGVuXCIpXG4gICAgICAgIGVkaXRvckVsZW1lbnQgPSBlbGVtZW50XG4gICAgICAgIGVkaXRvciA9IGVkaXRvckVsZW1lbnQuZ2V0TW9kZWwoKVxuICAgICAgICBhdG9tLmNvbW1hbmRzLmRpc3BhdGNoKGdldENvbW1hbmRFZGl0b3IoKSwgXCJjb3JlOmNhbmNlbFwiKVxuICAgICAgICB2aW1TdGF0ZSA9IHZpbU1vZGUubWFpbk1vZHVsZS5nZXRFZGl0b3JTdGF0ZShlZGl0b3IpXG4gICAgICAgIGV4U3RhdGUgPSBleE1vZGUubWFpbk1vZHVsZS5leFN0YXRlcy5nZXQoZWRpdG9yKVxuICAgICAgICB2aW1TdGF0ZS5yZXNldE5vcm1hbE1vZGUoKVxuICAgICAgICBlZGl0b3Iuc2V0VGV4dChcImFiY1xcbmRlZlxcbmFiY1xcbmRlZlwiKVxuXG4gIGFmdGVyRWFjaCAtPlxuICAgIGF0b20uY29tbWFuZHMuZGlzcGF0Y2goZ2V0Q29tbWFuZEVkaXRvcigpLCBcImNvcmU6Y2FuY2VsXCIpXG5cbiAgZ2V0VmlzaWJpbGl0eSA9ICgpIC0+XG4gICAgZWRpdG9yLm5vcm1hbE1vZGVJbnB1dFZpZXcucGFuZWwudmlzaWJsZVxuXG4gIGdldENvbW1hbmRFZGl0b3IgPSAoKSAtPlxuICAgIGVkaXRvci5ub3JtYWxNb2RlSW5wdXRWaWV3LmVkaXRvckVsZW1lbnRcblxuICBpdCBcIm9wZW5zIHdpdGggJ2V4LW1vZGU6b3BlbidcIiwgLT5cbiAgICBhdG9tLmNvbW1hbmRzLmRpc3BhdGNoKGVkaXRvckVsZW1lbnQsIFwiZXgtbW9kZTpvcGVuXCIpXG4gICAgZXhwZWN0KGdldFZpc2liaWxpdHkoKSkudG9CZSB0cnVlXG5cbiAgaXQgXCJjbG9zZXMgd2l0aCAnY29yZTpjYW5jZWwnXCIsIC0+XG4gICAgYXRvbS5jb21tYW5kcy5kaXNwYXRjaChlZGl0b3JFbGVtZW50LCBcImV4LW1vZGU6b3BlblwiKVxuICAgIGV4cGVjdChnZXRWaXNpYmlsaXR5KCkpLnRvQmUgdHJ1ZVxuICAgIGF0b20uY29tbWFuZHMuZGlzcGF0Y2goZ2V0Q29tbWFuZEVkaXRvcigpLCBcImNvcmU6Y2FuY2VsXCIpXG4gICAgZXhwZWN0KGdldFZpc2liaWxpdHkoKSkudG9CZSBmYWxzZVxuXG4gIGl0IFwiY2xvc2VzIHdoZW4gb3BlbmluZyBhbmQgdGhlbiBwcmVzc2luZyBiYWNrc3BhY2VcIiwgLT5cbiAgICBhdG9tLmNvbW1hbmRzLmRpc3BhdGNoKGVkaXRvckVsZW1lbnQsIFwiZXgtbW9kZTpvcGVuXCIpXG4gICAgZXhwZWN0KGdldFZpc2liaWxpdHkoKSkudG9CZSB0cnVlXG4gICAgYXRvbS5jb21tYW5kcy5kaXNwYXRjaChnZXRDb21tYW5kRWRpdG9yKCksIFwiY29yZTpiYWNrc3BhY2VcIilcbiAgICBleHBlY3QoZ2V0VmlzaWJpbGl0eSgpKS50b0JlIGZhbHNlXG5cbiAgaXQgXCJkb2Vzbid0IGNsb3NlIHdoZW4gdGhlcmUgaXMgdGV4dCBhbmQgcHJlc3NpbmcgYmFja3NwYWNlXCIsIC0+XG4gICAgYXRvbS5jb21tYW5kcy5kaXNwYXRjaChlZGl0b3JFbGVtZW50LCBcImV4LW1vZGU6b3BlblwiKVxuICAgIGV4cGVjdChnZXRWaXNpYmlsaXR5KCkpLnRvQmUgdHJ1ZVxuICAgIGNvbW1hbmRFZGl0b3IgPSBnZXRDb21tYW5kRWRpdG9yKClcbiAgICBtb2RlbCA9IGNvbW1hbmRFZGl0b3IuZ2V0TW9kZWwoKVxuICAgIG1vZGVsLnNldFRleHQoJ2FiYycpXG4gICAgYXRvbS5jb21tYW5kcy5kaXNwYXRjaChjb21tYW5kRWRpdG9yLCBcImNvcmU6YmFja3NwYWNlXCIpXG4gICAgZXhwZWN0KGdldFZpc2liaWxpdHkoKSkudG9CZSB0cnVlXG4gICAgZXhwZWN0KG1vZGVsLmdldFRleHQoKSkudG9CZSAnYWInXG5cbiAgaXQgXCJjbG9zZXMgd2hlbiB0aGVyZSBpcyB0ZXh0IGFuZCBwcmVzc2luZyBiYWNrc3BhY2UgbXVsdGlwbGUgdGltZXNcIiwgLT5cbiAgICBhdG9tLmNvbW1hbmRzLmRpc3BhdGNoKGVkaXRvckVsZW1lbnQsIFwiZXgtbW9kZTpvcGVuXCIpXG4gICAgZXhwZWN0KGdldFZpc2liaWxpdHkoKSkudG9CZSB0cnVlXG4gICAgY29tbWFuZEVkaXRvciA9IGdldENvbW1hbmRFZGl0b3IoKVxuICAgIG1vZGVsID0gY29tbWFuZEVkaXRvci5nZXRNb2RlbCgpXG4gICAgZXhwZWN0KG1vZGVsLmdldFRleHQoKSkudG9CZSAnJ1xuICAgIG1vZGVsLnNldFRleHQoJ2FiYycpXG4gICAgYXRvbS5jb21tYW5kcy5kaXNwYXRjaChjb21tYW5kRWRpdG9yLCBcImNvcmU6YmFja3NwYWNlXCIpXG4gICAgZXhwZWN0KGdldFZpc2liaWxpdHkoKSkudG9CZSB0cnVlXG4gICAgZXhwZWN0KG1vZGVsLmdldFRleHQoKSkudG9CZSAnYWInXG4gICAgYXRvbS5jb21tYW5kcy5kaXNwYXRjaChjb21tYW5kRWRpdG9yLCBcImNvcmU6YmFja3NwYWNlXCIpXG4gICAgZXhwZWN0KGdldFZpc2liaWxpdHkoKSkudG9CZSB0cnVlXG4gICAgZXhwZWN0KG1vZGVsLmdldFRleHQoKSkudG9CZSAnYSdcbiAgICBhdG9tLmNvbW1hbmRzLmRpc3BhdGNoKGNvbW1hbmRFZGl0b3IsIFwiY29yZTpiYWNrc3BhY2VcIilcbiAgICBleHBlY3QoZ2V0VmlzaWJpbGl0eSgpKS50b0JlIHRydWVcbiAgICBleHBlY3QobW9kZWwuZ2V0VGV4dCgpKS50b0JlICcnXG4gICAgYXRvbS5jb21tYW5kcy5kaXNwYXRjaChjb21tYW5kRWRpdG9yLCBcImNvcmU6YmFja3NwYWNlXCIpXG4gICAgZXhwZWN0KGdldFZpc2liaWxpdHkoKSkudG9CZSBmYWxzZVxuXG4gIGl0IFwiY29udGFpbnMgJzwsJz4gd2hlbiBvcGVuZWQgd2hpbGUgdGhlcmUgYXJlIHNlbGVjdGlvbnNcIiwgLT5cbiAgICBlZGl0b3Iuc2V0Q3Vyc29yQnVmZmVyUG9zaXRpb24oWzAsIDBdKVxuICAgIGVkaXRvci5zZWxlY3RUb0J1ZmZlclBvc2l0aW9uKFswLCAxXSlcbiAgICBlZGl0b3IuYWRkQ3Vyc29yQXRCdWZmZXJQb3NpdGlvbihbMiwgMF0pXG4gICAgZWRpdG9yLnNlbGVjdFRvQnVmZmVyUG9zaXRpb24oWzIsIDFdKVxuICAgIGF0b20uY29tbWFuZHMuZGlzcGF0Y2goZWRpdG9yRWxlbWVudCwgXCJleC1tb2RlOm9wZW5cIilcbiAgICBleHBlY3QoZ2V0Q29tbWFuZEVkaXRvcigpLmdldE1vZGVsKCkuZ2V0VGV4dCgpKS50b0JlIFwiJzwsJz5cIlxuIl19
